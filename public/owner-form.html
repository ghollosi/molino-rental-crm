<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√öj tulajdonos l√©trehoz√°sa - Molino CRM</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; background: #f8fafc; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 24px; }
        h1 { color: #1e293b; margin-bottom: 24px; font-size: 24px; }
        .form-group { margin-bottom: 16px; }
        label { display: block; margin-bottom: 6px; font-weight: 500; color: #374151; }
        input { width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; }
        input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .btn { background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; margin-right: 8px; }
        .btn:hover { background: #2563eb; }
        .btn:disabled { background: #9ca3af; cursor: not-allowed; }
        .btn-secondary { background: #6b7280; }
        .btn-secondary:hover { background: #4b5563; }
        .alert { padding: 12px; border-radius: 6px; margin-bottom: 16px; }
        .alert-success { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }
        .alert-error { background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }
        .back-link { display: inline-block; margin-bottom: 16px; color: #3b82f6; text-decoration: none; }
        .back-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <a href="/dashboard/owners" class="back-link">‚Üê Vissza a tulajdonosokhoz</a>
        
        <h1>üè† √öj tulajdonos l√©trehoz√°sa</h1>
        
        <div id="alert-container"></div>
        
        <form id="ownerForm">
            <div class="form-group">
                <label for="name">N√©v *</label>
                <input type="text" id="name" name="name" required placeholder="Teljes n√©v">
            </div>
            
            <div class="form-group">
                <label for="email">Email c√≠m *</label>
                <input type="email" id="email" name="email" required placeholder="email@example.com">
            </div>
            
            <div class="form-group">
                <label for="password">Jelsz√≥ *</label>
                <input type="password" id="password" name="password" required placeholder="Legal√°bb 6 karakter" minlength="6">
            </div>
            
            <div class="form-group">
                <label for="phone">Telefon</label>
                <input type="tel" id="phone" name="phone" placeholder="+36 20 123 4567">
            </div>
            
            <div>
                <button type="submit" class="btn" id="submitBtn">Tulajdonos l√©trehoz√°sa</button>
                <button type="button" class="btn btn-secondary" onclick="window.location.href='/dashboard/owners'">M√©gse</button>
            </div>
        </form>
    </div>

    <script>
        document.getElementById('ownerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const alertContainer = document.getElementById('alert-container');
            
            // Get form data
            const formData = new FormData(this);
            const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                password: formData.get('password'),
                phone: formData.get('phone') || undefined
            };
            
            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.textContent = 'L√©trehoz√°s...';
            alertContainer.innerHTML = '';
            
            try {
                const response = await fetch('/api/trpc/owner.quickCreate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        "0": {
                            "json": data
                        }
                    })
                });
                
                const result = await response.json();
                console.log('Response:', result);
                
                if (response.ok && result[0]?.result?.data) {
                    alertContainer.innerHTML = '<div class="alert alert-success">‚úÖ Tulajdonos sikeresen l√©trehozva! √Åtir√°ny√≠t√°s...</div>';
                    setTimeout(() => {
                        window.location.href = '/dashboard/owners';
                    }, 1500);
                } else {
                    const errorMsg = result[0]?.error?.message || result.error || 'Hiba t√∂rt√©nt a tulajdonos l√©trehoz√°s√°n√°l';
                    alertContainer.innerHTML = '<div class="alert alert-error">‚ùå ' + errorMsg + '</div>';
                }
            } catch (error) {
                console.error('Error:', error);
                alertContainer.innerHTML = '<div class="alert alert-error">‚ùå H√°l√≥zati hiba t√∂rt√©nt</div>';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Tulajdonos l√©trehoz√°sa';
            }
        });
    </script>
</body>
</html>